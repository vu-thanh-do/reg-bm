<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HD CodeLab - HD FutureTech</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="window">
        <div class="title-bar">
            <div class="title">
                <span>AUTO REG BM-TIKTOK</span>
            </div>
            <div class="controls">
                <button>‚àí</button>
                <button>‚ñ°</button>
                <button>√ó</button>
            </div>
        </div>

        <div class="main-content">
            <div class="left-panel">
                <div class="table-container">
                    <table id="resultTable">
                        <thead>
                            <tr>
                                <th style="width: 40px;">#</th>
                                <th>Email</th>
                                <th>Password</th>
                                <th>Status</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody id="resultTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="right-panel">
                <div style="overflow-y: auto;" class="function-group">
                    <div class="function-title">Ch·ª©c nƒÉng</div>
                    <div class="button-group">
                        <button class="button primary">‚ñ∂ B·∫Øt ƒê·∫ßu</button>
                        <button class="button">‚è∏ D·ª´ng</button>
                    </div>
                    <div class="button-group">
                        <button class="button secondary" id="apiKeysBtn">üîë API Keys</button>
                        <button class="button secondary" id="testServicesBtn">üß™ Test</button>
                    </div>
                    <div class="button-group">
                        <button class="button" id="backupStatsBtn">üìä Th·ªëng k√™ Backup</button>
                        <button class="button secondary" id="exportBackupBtn">üì§ Export Backup</button>
                    </div>
                    <div class="section-title">C√†i ƒë·∫∑t chung</div>
                    <div class="form-group">
                        <label>S·ªë lu·ªìng:</label>
                        <select id="threadCountSelect">
                            <option value="1">1</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                            <option value="20">20</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Lo·∫°i proxy:</label>
                        <select name="proxy-type">
                            <option value="prx922">API Pia 922</option>
                            <option value="static">PROXY Tƒ®NH</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Website Mail:</label>
                        <select id="mailServiceSelect">
                            <option value="mail.tm">mail.tm</option>
                            <option value="inboxes.com">inboxes.com</option>
                            <option value="hunght189.com">hunght189.com</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>List Proxy:</label>
                        <textarea>103.35.77.31:8774:cuongnhFT:WCK</textarea>
                    </div>
                    <div class="form-group">
                        <label>ƒê∆∞·ªùng d·∫´n l∆∞u Excel:</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="text" id="excelPathInput" readonly style="flex:1;" placeholder="Ch∆∞a ch·ªçn...">
                            <button type="button" class="button" id="chooseExcelPathBtn">Ch·ªçn...</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Lo·∫°i account:</label>
                        <select id="accountTypeSelect">
                            <option value="bc">BC th∆∞·ªùng</option>
                            <option value="agency">BC agency</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Qu·ªëc gia t·∫°o BC:</label>
                        <select id="countrySelect"></select>
                    </div>
                    <div class="form-group">
                        <label>M√∫i gi·ªù:</label>
                        <select id="timezoneSelect"></select>
                    </div>
                    <div class="form-group">
                        <label>Ti·ªÅn t·ªá:</label>
                        <select id="currencySelect"></select>
                    </div>
                    <div class="form-group">
                        <label>T√™n c√¥ng ty:</label>
                        <input type="text" id="companyNameInput" placeholder="Nh·∫≠p t√™n c√¥ng ty (t√πy ch·ªçn)">
                    </div>
                    <div class="form-group">
                        <label>Website c√¥ng ty:</label>
                        <input type="text" id="companyWebsiteInput" placeholder="Nh·∫≠p website (t√πy ch·ªçn)">
                    </div>
                    <div class="form-group">
                        <label>N∆°i ƒëƒÉng k√≠:</label>
                        <select id="companyCountrySelect"></select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- API Keys Modal -->
    <div id="apiKeysModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Qu·∫£n l√Ω API Keys</h2>
                <span class="close" id="closeApiKeysModal">&times;</span>
            </div>

            <div id="apiKeysContent">
                <!-- Content will be loaded here -->
            </div>

            <div style="margin-top: 20px; text-align: right;">
                <button class="button secondary" id="resetConfigBtn">Reset v·ªÅ m·∫∑c ƒë·ªãnh</button>
                <button class="button primary" id="saveConfigBtn">L∆∞u c·∫•u h√¨nh</button>
            </div>
        </div>
    </div>

    <script>
        let currentConfig = {};
        let regResults = [];

        // --- D·ªØ li·ªáu qu·ªëc gia, m√∫i gi·ªù, ti·ªÅn t·ªá ---
        const countryList = [
            "Argentina", "Australia", "Austria", "Bahrain", "Belarus", "Belgium", "Bolivia (Plurinational State of)", "Brazil", "Bulgaria", "Cambodia", "Canada", "Chile", "China Outbound", "Colombia", "Costa Rica", "Croatia", "Czechia", "Denmark", "Dominican Republic", "Ecuador", "Egypt", "Estonia", "Finland", "France", "Germany", "Greece", "Guatemala", "Hong Kong", "Hungary", "India", "Indonesia", "Iraq", "Ireland", "Israel", "Italy", "Japan", "Jordan", "Kazakhstan", "Korea", "Kuwait", "Latvia", "Lebanon", "Lithuania", "Malaysia", "Mexico", "Morocco", "Netherlands", "New Zealand", "Norway", "Oman", "Pakistan", "Panama", "Peru", "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "San Marino", "Saudi Arabia", "Serbia", "Singapore", "Slovakia", "Slovenia", "South Africa", "Spain", "Sri Lanka", "Sweden", "Switzerland", "Taiwan", "Thailand", "Turkey", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Vietnam"
        ];
        const vietCountryList = [
            "C·ªông h√≤a Dominica", "Panama", "Bahrain", "Kazakhstan", "Belarus", "Sri Lanka", "Guatemala", "Bolivia (Nh√† n∆∞·ªõc ƒëa nguy√™n)", "Costa Rica", "Argentina", "Ngo√†i l√£nh th·ªï Trung Qu·ªëc", "H·ªìng K√¥ng", "Colombia", "Chile", "Peru", "Ecuador", "Mexico", "Nam Phi", "Morocco", "Campuchia", "C√°c Ti·ªÉu V∆∞∆°ng Qu·ªëc ·∫¢ R·∫≠p Th·ªëng Nh·∫•t", "·∫¢ R·∫≠p X√™ √∫t", "Vi·ªát Nam", "Th·ªï Nhƒ© K·ª≥", "New Zealand", "Th·ª•y Sƒ©", "Na Uy", "Romania", "Hungary", "B·ªâ", "H√† Lan", "ƒêan M·∫°ch", "Ph·∫ßn Lan", "B·ªì ƒê√†o Nha", "Hy L·∫°p", "Kuwait", "Qatar", "Brazil", "Nh·∫≠t B·∫£n", "Indonesia", "Malaysia", "Th√°i Lan", "Ai C·∫≠p", "H√†n Qu·ªëc", "Nga", "Israel", "Hoa K·ª≥", "Ph√°p", "√ù", "V∆∞∆°ng qu·ªëc Anh", "T√¢y Ban Nha", "Singapore", "Canada", "ƒê·ª©c", "Philippines", "Ba Lan", "Czechia", "Ireland", "√Åo", "Th·ª•y ƒêi·ªÉn", "√öc", "Ukraine"
        ];
        const timezoneList = [{
            value: 'UTC-12:00',
            label: '(UTC-12:00) International Date Line West'
        }, {
            value: 'UTC-11:00',
            label: '(UTC-11:00) Midway Island, Samoa'
        }, {
            value: 'UTC-10:00',
            label: '(UTC-10:00) Hawaii'
        }, {
            value: 'UTC-09:00',
            label: '(UTC-09:00) Alaska'
        }, {
            value: 'UTC-08:00',
            label: '(UTC-08:00) Pacific Time (US & Canada)'
        }, {
            value: 'UTC-07:00',
            label: '(UTC-07:00) Mountain Time (US & Canada)'
        }, {
            value: 'UTC-06:00',
            label: '(UTC-06:00) Central Time (US & Canada), Mexico City'
        }, {
            value: 'UTC-05:00',
            label: '(UTC-05:00) Eastern Time (US & Canada), Bogota, Lima'
        }, {
            value: 'UTC-04:00',
            label: '(UTC-04:00) Atlantic Time (Canada), Caracas, La Paz'
        }, {
            value: 'UTC-03:30',
            label: '(UTC-03:30) Newfoundland'
        }, {
            value: 'UTC-03:00',
            label: '(UTC-03:00) Brazil, Buenos Aires, Georgetown'
        }, {
            value: 'UTC-02:00',
            label: '(UTC-02:00) Mid-Atlantic'
        }, {
            value: 'UTC-01:00',
            label: '(UTC-01:00) Azores, Cape Verde Islands'
        }, {
            value: 'UTC+00:00',
            label: '(UTC+00:00) Western Europe Time, London, Lisbon, Casablanca'
        }, {
            value: 'UTC+01:00',
            label: '(UTC+01:00) Brussels, Copenhagen, Madrid, Paris'
        }, {
            value: 'UTC+02:00',
            label: '(UTC+02:00) Kaliningrad, South Africa'
        }, {
            value: 'UTC+03:00',
            label: '(UTC+03:00) Baghdad, Riyadh, Moscow, St. Petersburg'
        }, {
            value: 'UTC+03:30',
            label: '(UTC+03:30) Tehran'
        }, {
            value: 'UTC+04:00',
            label: '(UTC+04:00) Abu Dhabi, Muscat, Baku, Tbilisi'
        }, {
            value: 'UTC+04:30',
            label: '(UTC+04:30) Kabul'
        }, {
            value: 'UTC+05:00',
            label: '(UTC+05:00) Ekaterinburg, Islamabad, Karachi, Tashkent'
        }, {
            value: 'UTC+05:30',
            label: '(UTC+05:30) Bombay, Calcutta, Madras, New Delhi'
        }, {
            value: 'UTC+05:45',
            label: '(UTC+05:45) Kathmandu'
        }, {
            value: 'UTC+06:00',
            label: '(UTC+06:00) Almaty, Dhaka, Colombo'
        }, {
            value: 'UTC+06:30',
            label: '(UTC+06:30) Yangon, Cocos Islands'
        }, {
            value: 'UTC+07:00',
            label: '(UTC+07:00) Bangkok, Hanoi, Jakarta'
        }, {
            value: 'UTC+08:00',
            label: '(UTC+08:00) Beijing, Perth, Singapore, Hong Kong'
        }, {
            value: 'UTC+09:00',
            label: '(UTC+09:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk'
        }, {
            value: 'UTC+09:30',
            label: '(UTC+09:30) Adelaide, Darwin'
        }, {
            value: 'UTC+10:00',
            label: '(UTC+10:00) Eastern Australia, Guam, Vladivostok'
        }, {
            value: 'UTC+11:00',
            label: '(UTC+11:00) Magadan, Solomon Islands, New Caledonia'
        }, {
            value: 'UTC+12:00',
            label: '(UTC+12:00) Auckland, Wellington, Fiji, Kamchatka'
        }, {
            value: 'UTC+13:00',
            label: '(UTC+13:00) Nuku',
        }, {
            value: 'UTC+14:00',
            label: '(UTC+14:00) Line Islands'
        }];
        const currencyList = [{
            value: 'USD',
            label: 'USD - US Dollar'
        }, {
            value: 'EUR',
            label: 'EUR - Euro'
        }, {
            value: 'VND',
            label: 'VND - Vietnamese Dong'
        }, {
            value: 'JPY',
            label: 'JPY - Japanese Yen'
        }, {
            value: 'CNY',
            label: 'CNY - Chinese Yuan'
        }, {
            value: 'KRW',
            label: 'KRW - South Korean Won'
        }, {
            value: 'GBP',
            label: 'GBP - British Pound'
        }, {
            value: 'AUD',
            label: 'AUD - Australian Dollar'
        }, {
            value: 'CAD',
            label: 'CAD - Canadian Dollar'
        }, {
            value: 'RUB',
            label: 'RUB - Russian Ruble'
        }, {
            value: 'INR',
            label: 'INR - Indian Rupee'
        }, {
            value: 'THB',
            label: 'THB - Thai Baht'
        }, {
            value: 'SGD',
            label: 'SGD - Singapore Dollar'
        }, {
            value: 'MYR',
            label: 'MYR - Malaysian Ringgit'
        }, {
            value: 'IDR',
            label: 'IDR - Indonesian Rupiah'
        }, {
            value: 'BRL',
            label: 'BRL - Brazilian Real'
        }, {
            value: 'TRY',
            label: 'TRY - Turkish Lira'
        }, {
            value: 'PHP',
            label: 'PHP - Philippine Peso'
        }, {
            value: 'PLN',
            label: 'PLN - Polish Zloty'
        }, {
            value: 'CHF',
            label: 'CHF - Swiss Franc'
        }, {
            value: 'SEK',
            label: 'SEK - Swedish Krona'
        }, {
            value: 'NOK',
            label: 'NOK - Norwegian Krone'
        }, {
            value: 'DKK',
            label: 'DKK - Danish Krone'
        }, {
            value: 'CZK',
            label: 'CZK - Czech Koruna'
        }, {
            value: 'HUF',
            label: 'HUF - Hungarian Forint'
        }, {
            value: 'ILS',
            label: 'ILS - Israeli New Shekel'
        }, {
            value: 'SAR',
            label: 'SAR - Saudi Riyal'
        }, {
            value: 'AED',
            label: 'AED - UAE Dirham'
        }, {
            value: 'ZAR',
            label: 'ZAR - South African Rand'
        }];

        document.addEventListener('DOMContentLoaded', function() {
            // Controls Electron window
            const btnMin = document.querySelector('.controls button:nth-child(1)');
            const btnMax = document.querySelector('.controls button:nth-child(2)');
            const btnClose = document.querySelector('.controls button:nth-child(3)');
            if (window.electronAPI) {
                btnMin.addEventListener('click', () => window.electronAPI.minimize());
                btnMax.addEventListener('click', () => window.electronAPI.maximize());
                btnClose.addEventListener('click', () => window.electronAPI.close());
            }

            // Load config on startup
            loadConfig();

            // API Keys Modal
            const apiKeysBtn = document.getElementById('apiKeysBtn');
            const apiKeysModal = document.getElementById('apiKeysModal');
            const closeApiKeysModal = document.getElementById('closeApiKeysModal');
            const saveConfigBtn = document.getElementById('saveConfigBtn');
            const resetConfigBtn = document.getElementById('resetConfigBtn');

            apiKeysBtn.addEventListener('click', () => {
                loadConfig();
                apiKeysModal.style.display = 'block';
            });

            closeApiKeysModal.addEventListener('click', () => {
                apiKeysModal.style.display = 'none';
            });

            window.addEventListener('click', (event) => {
                if (event.target === apiKeysModal) {
                    apiKeysModal.style.display = 'none';
                }
            });

            saveConfigBtn.addEventListener('click', saveConfig);
            resetConfigBtn.addEventListener('click', resetConfig);

            // Test Services
            const testServicesBtn = document.getElementById('testServicesBtn');
            testServicesBtn.addEventListener('click', testAllServices);

            // Backup Management
            const backupStatsBtn = document.getElementById('backupStatsBtn');
            const exportBackupBtn = document.getElementById('exportBackupBtn');

            backupStatsBtn.addEventListener('click', async() => {
                const originalText = backupStatsBtn.textContent;
                backupStatsBtn.textContent = 'üîÑ ƒêang t·∫£i...';
                backupStatsBtn.disabled = true;

                try {
                    if (window.electronAPI && window.electronAPI.getBackupStats) {
                        const result = await window.electronAPI.getBackupStats();

                        if (result.success) {
                            const stats = result.stats;

                            let accountTypeStats = '';
                            for (const [type, count] of Object.entries(stats.byAccountType)) {
                                accountTypeStats += `- ${type}: ${count}\n`;
                            }

                            let billingTypeStats = '';
                            for (const [type, count] of Object.entries(stats.byBillingType)) {
                                billingTypeStats += `- ${type}: ${count}\n`;
                            }

                            let bcTypeStats = '';
                            for (const [type, count] of Object.entries(stats.byBcType)) {
                                bcTypeStats += `- ${type}: ${count}\n`;
                            }

                            alert(`üìä TH·ªêNG K√ä BACKUP CHI TI·∫æT\n\n` +
                                `T·ªïng s·ªë records: ${stats.total}\n` +
                                `Ho√†n th√†nh: ${stats.completed}\n` +
                                `Th√†nh c√¥ng (ch∆∞a ho√†n th√†nh): ${stats.successful - stats.completed}\n` +
                                `Th·∫•t b·∫°i: ${stats.failed}\n\n` +
                                `üìã Theo Account Type (user ch·ªçn):\n${accountTypeStats || 'Ch∆∞a c√≥ d·ªØ li·ªáu'}\n` +
                                `üí≥ Theo Billing Type (auto detect):\n${billingTypeStats || 'Ch∆∞a c√≥ d·ªØ li·ªáu'}\n` +
                                `üîó Theo BC Type (combined):\n${bcTypeStats || 'Ch∆∞a c√≥ d·ªØ li·ªáu'}`);
                        } else {
                            alert('‚ùå L·ªói l·∫•y th·ªëng k√™: ' + result.error);
                        }
                    }
                } catch (error) {
                    alert('‚ùå L·ªói: ' + error.message);
                } finally {
                    backupStatsBtn.textContent = originalText;
                    backupStatsBtn.disabled = false;
                }
            });

            exportBackupBtn.addEventListener('click', async() => {
                if (window.electronAPI && window.electronAPI.chooseExcelPath) {
                    const excelPath = await window.electronAPI.chooseExcelPath();
                    if (!excelPath) return;

                    const originalText = exportBackupBtn.textContent;
                    exportBackupBtn.textContent = 'üîÑ ƒêang export...';
                    exportBackupBtn.disabled = true;

                    try {
                        if (window.electronAPI.exportBackupToExcel) {
                            const result = await window.electronAPI.exportBackupToExcel(excelPath);

                            if (result.success) {
                                alert(`‚úÖ Export th√†nh c√¥ng!\n\nFile Excel: ${excelPath}`);
                            } else {
                                alert('‚ùå L·ªói export: ' + result.error);
                            }
                        }
                    } catch (error) {
                        alert('‚ùå L·ªói: ' + error.message);
                    } finally {
                        exportBackupBtn.textContent = originalText;
                        exportBackupBtn.disabled = false;
                    }
                }
            });

            // ƒê·ªï d·ªØ li·ªáu qu·ªëc gia
            const countrySelect = document.getElementById('countrySelect');
            countryList.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                countrySelect.appendChild(opt);
            });
            // ƒê·ªï d·ªØ li·ªáu m√∫i gi·ªù
            const timezoneSelect = document.getElementById('timezoneSelect');
            timezoneList.forEach(tz => {
                const opt = document.createElement('option');
                opt.value = tz.value;
                opt.textContent = tz.label;
                timezoneSelect.appendChild(opt);
            });
            // ƒê·ªï d·ªØ li·ªáu ti·ªÅn t·ªá
            const currencySelect = document.getElementById('currencySelect');
            currencyList.forEach(cur => {
                const opt = document.createElement('option');
                opt.value = cur.value;
                opt.textContent = cur.label;
                currencySelect.appendChild(opt);
            });

            // ƒê·ªï d·ªØ li·ªáu qu·ªëc gia cho N∆°i ƒëƒÉng k√≠
            const companyCountrySelect = document.getElementById('companyCountrySelect');
            vietCountryList.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                companyCountrySelect.appendChild(opt);
            });

            // Ch·ªçn ƒë∆∞·ªùng d·∫´n l∆∞u Excel
            const excelPathInput = document.getElementById('excelPathInput');
            const chooseExcelPathBtn = document.getElementById('chooseExcelPathBtn');
            let excelPath = '';
            chooseExcelPathBtn.addEventListener('click', async() => {
                if (window.electronAPI && window.electronAPI.chooseExcelPath) {
                    const path = await window.electronAPI.chooseExcelPath();
                    if (path) {
                        excelPath = path;
                        excelPathInput.value = path;
                    }
                }
            });

            // B·∫Øt s·ª± ki·ªán B·∫Øt ƒê·∫ßu
            const btnStart = document.querySelector('.button.primary');
            btnStart.addEventListener('click', async() => {
                // L·∫•y to√†n b·ªô config giao di·ªán
                const proxyTextarea = document.querySelector('textarea');
                let proxyList = [];
                if (proxyTextarea) {
                    proxyList = proxyTextarea.value.split('\n').map(l => l.trim()).filter(Boolean);
                }
                const userConfig = {
                    accountType: document.getElementById('accountTypeSelect').value,
                    country: document.getElementById('countrySelect').value,
                    timezone: document.getElementById('timezoneSelect').value,
                    currency: document.getElementById('currencySelect').value,
                    mailService: document.getElementById('mailServiceSelect').value,
                    threadCount: parseInt(document.getElementById('threadCountSelect').value, 10),
                    excelPath: excelPath,
                    proxyList: proxyList,
                    companyName: document.getElementById('companyNameInput').value.trim(),
                    companyWebsite: document.getElementById('companyWebsiteInput').value.trim(),
                    companyCountry: document.getElementById('companyCountrySelect').value.trim()
                };
                // Reset b·∫£ng k·∫øt qu·∫£
                regResults = [];
                renderResultTable();
                // G·ª≠i v·ªÅ main process
                if (window.electronAPI && window.electronAPI.startAutomation) {
                    await window.electronAPI.startAutomation(userConfig);
                }
            });

            // H√†m c·∫≠p nh·∫≠t b·∫£ng k·∫øt qu·∫£
            function renderResultTable() {
                const tbody = document.getElementById('resultTableBody');
                tbody.innerHTML = '';
                regResults.forEach((row, idx) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${idx + 1}</td>
                        <td>${row.email || ''}</td>
                        <td>${row.password || ''}</td>
                        <td>${row.status || ''}</td>
                        <td>${row.message || ''}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            // IPC nh·∫≠n k·∫øt qu·∫£ reg t·ª´ main process
            if (window.electronAPI) {
                window.electronAPI.onRegResult && window.electronAPI.onRegResult((event, result) => {
                    regResults.push(result);
                    renderResultTable();
                });
            }
            const proxyTypeSelect = document.querySelector('select[name="proxy-type"]');
            const listProxyGroup = Array.from(document.querySelectorAll('.form-group')).find(group => {
                const label = group.querySelector('label');
                return label && label.textContent.includes('List Proxy');
            });

            function updateListProxyVisibility() {
                if (!proxyTypeSelect || !listProxyGroup) return;
                if (proxyTypeSelect.value === 'prx922') {
                    listProxyGroup.style.display = 'none';
                } else {
                    listProxyGroup.style.display = '';
                }
            }
            if (proxyTypeSelect && listProxyGroup) {
                proxyTypeSelect.addEventListener('change', updateListProxyVisibility);
                updateListProxyVisibility();
            }

            const btnStop = document.querySelector('.button:not(.primary)');
            btnStop.addEventListener('click', async() => {
                if (window.electronAPI && window.electronAPI.stopAutomation) {
                    await window.electronAPI.stopAutomation();
                }
            });
        });

        async function loadConfig() {
            try {
                const result = await window.electronAPI.getConfig();
                if (result.success) {
                    currentConfig = result.config;
                    renderConfigUI();
                } else {
                    console.error('Failed to load config:', result.error);
                }
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }

        function renderConfigUI() {
            const content = document.getElementById('apiKeysContent');
            content.innerHTML = '';

            const services = [{
                key: 'mailTm',
                name: 'Mail.tm',
                description: 'Email service kh√¥ng c·∫ßn API key'
            }, {
                key: 'inboxes',
                name: 'Inboxes.com',
                description: 'RapidAPI Inboxes service'
            }, {
                key: 'codesim',
                name: 'Codesim',
                description: 'Codesim API service'
            }, {
                key: 'omoCaptcha',
                name: 'OmoCaptcha',
                description: 'OmoCaptcha API service'
            }];

            services.forEach(service => {
                const serviceConfig = currentConfig[service.key] || {};
                const serviceDiv = document.createElement('div');
                serviceDiv.className = 'service-config';

                serviceDiv.innerHTML = `
                    <div class="service-header">
                        <div>
                            <span class="service-name">${service.name}</span>
                            <span class="status-indicator ${serviceConfig.enabled ? 'status-active' : 'status-inactive'}"></span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" ${serviceConfig.enabled ? 'checked' : ''} 
                                   onchange="toggleService('${service.key}', this.checked)">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>API Key:</label>
                        <input type="text" class="api-key-input" 
                               value="${serviceConfig.apiKey || ''}" 
                               placeholder="Nh·∫≠p API key..."
                               onchange="updateApiKey('${service.key}', this.value)">
                        <button class="test-button" onclick="testService('${service.key}')" 
                                ${!serviceConfig.enabled ? 'disabled' : ''}>
                            Test
                        </button>
                    </div>
                    <div style="font-size: 11px; color: #6c757d; margin-top: 8px;">
                        ${service.description}
                    </div>
                `;

                content.appendChild(serviceDiv);
            });
        }

        async function toggleService(serviceName, enabled) {
            try {
                const result = await window.electronAPI.setServiceEnabled(serviceName, enabled);
                if (result.success) {
                    currentConfig[serviceName] = currentConfig[serviceName] || {};
                    currentConfig[serviceName].enabled = enabled;
                    renderConfigUI();
                } else {
                    console.error('Failed to toggle service:', result.error);
                }
            } catch (error) {
                console.error('Error toggling service:', error);
            }
        }

        async function updateApiKey(serviceName, apiKey) {
            try {
                const result = await window.electronAPI.updateApiKey(serviceName, apiKey);
                if (result.success) {
                    currentConfig[serviceName] = currentConfig[serviceName] || {};
                    currentConfig[serviceName].apiKey = apiKey;
                } else {
                    console.error('Failed to update API key:', result.error);
                }
            } catch (error) {
                console.error('Error updating API key:', error);
            }
        }

        async function saveConfig() {
            // Config is already saved when individual fields are updated
            alert('C·∫•u h√¨nh ƒë√£ ƒë∆∞·ª£c l∆∞u!');
        }

        async function resetConfig() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën reset v·ªÅ c·∫•u h√¨nh m·∫∑c ƒë·ªãnh?')) {
                try {
                    const result = await window.electronAPI.resetConfig();
                    if (result.success) {
                        await loadConfig();
                        alert('ƒê√£ reset v·ªÅ c·∫•u h√¨nh m·∫∑c ƒë·ªãnh!');
                    } else {
                        console.error('Failed to reset config:', result.error);
                    }
                } catch (error) {
                    console.error('Error resetting config:', error);
                }
            }
        }
        async function testService(serviceName) {
            const testBtn = event.target;
            const originalText = testBtn.textContent;
            testBtn.textContent = 'Testing...';
            testBtn.disabled = true;

            try {
                const result = await window.electronAPI.testService(serviceName);
                if (result.success) {
                    alert(`${serviceName} ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng!`);
                } else {
                    alert(`L·ªói: ${result.error}`);
                }
            } catch (error) {
                alert(`L·ªói khi test: ${error.message}`);
            } finally {
                testBtn.textContent = originalText;
                testBtn.disabled = false;
            }
        }
        async function testAllServices() {
            const services = ['mailTm', 'inboxes', 'hunght189', 'tmailor'];
            let results = [];
            for (const service of services) {
                try {
                    const result = await window.electronAPI.testService(service);
                    results.push(`${service}: ${result.success ? '‚úÖ OK' : '‚ùå L·ªói'}`);
                } catch (error) {
                    results.push(`${service}: ‚ùå L·ªói`);
                }
            }
            alert('K·∫øt qu·∫£ test:\n' + results.join('\n'));
        }
    </script>
</body>

</html>